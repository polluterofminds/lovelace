// Cloudflare Workers compatibility
const process = { env: {} };
const global = globalThis;
var Dt=Object.defineProperty;var Ye=e=>{throw TypeError(e)};var Lt=(e,t,r)=>t in e?Dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var d=(e,t,r)=>Lt(e,typeof t!="symbol"?t+"":t,r),Me=(e,t,r)=>t.has(e)||Ye("Cannot "+r);var o=(e,t,r)=>(Me(e,t,"read from private field"),r?r.call(e):t.get(e)),p=(e,t,r)=>t.has(e)?Ye("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),f=(e,t,r,s)=>(Me(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),m=(e,t,r)=>(Me(e,t,"access private method"),r);var Je=(e,t,r,s)=>({set _(n){f(e,t,n,r)},get _(){return o(e,t,s)}});var $e=(e,t,r)=>(s,n)=>{let i=-1;return a(0);async function a(l){if(l<=i)throw new Error("next() called multiple times");i=l;let c,h=!1,u;if(e[l]?(u=e[l][0][0],s.req.routeIndex=l):u=l===e.length&&n||void 0,u)try{c=await u(s,()=>a(l+1))}catch(g){if(g instanceof Error&&t)s.error=g,c=await t(g,s),h=!0;else throw g}else s.finalized===!1&&r&&(c=await r(s));return c&&(s.finalized===!1||h)&&(s.res=c),s}};var Ze=Symbol();var et=async(e,t=Object.create(null))=>{let{all:r=!1,dot:s=!1}=t,i=(e instanceof we?e.raw.headers:e.headers).get("Content-Type");return i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded")?Mt(e,{all:r,dot:s}):{}};async function Mt(e,t){let r=await e.formData();return r?$t(r,t):{}}function $t(e,t){let r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?Nt(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(It(r,s,n),delete r[s])}),r}var Nt=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},It=(e,t,r)=>{let s=e,n=t.split(".");n.forEach((i,a)=>{a===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})};var Ie=e=>{let t=e.split("/");return t[0]===""&&t.shift(),t},tt=e=>{let{groups:t,path:r}=kt(e),s=Ie(r);return qt(s,t)},kt=e=>{let t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{let n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},qt=(e,t)=>{for(let r=t.length-1;r>=0;r--){let[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},xe={},rt=(e,t)=>{if(e==="*")return"*";let r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){let s=`${e}#${t}`;return xe[s]||(r[2]?xe[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:xe[s]=[e,r[1],!0]),xe[s]}return null},ve=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},Bt=e=>ve(e,decodeURI),ke=e=>{let t=e.url,r=t.indexOf("/",t.charCodeAt(9)===58?13:8),s=r;for(;s<t.length;s++){let n=t.charCodeAt(s);if(n===37){let i=t.indexOf("?",s),a=t.slice(r,i===-1?void 0:i);return Bt(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return t.slice(r,s)};var st=e=>{let t=ke(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},W=(e,t,...r)=>(r.length&&(t=W(t,...r)),`${e?.[0]==="/"?"":"/"}${e}${t==="/"?"":`${e?.at(-1)==="/"?"":"/"}${t?.[0]==="/"?t.slice(1):t}`}`),be=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;let t=e.split("/"),r=[],s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);let i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,a)=>a.indexOf(n)===i)},Ne=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?ve(e,qe):e):e,nt=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){let l=e.charCodeAt(a+t.length+1);if(l===61){let c=a+t.length+2,h=e.indexOf("&",c);return Ne(e.slice(c,h===-1?void 0:h))}else if(l==38||isNaN(l))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}let n={};s??(s=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){let a=e.indexOf("&",i+1),l=e.indexOf("=",i);l>a&&a!==-1&&(l=-1);let c=e.slice(i+1,l===-1?a===-1?void 0:a:l);if(s&&(c=Ne(c)),i=a,c==="")continue;let h;l===-1?h="":(h=e.slice(l+1,a===-1?void 0:a),s&&(h=Ne(h))),r?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(h)):n[c]??(n[c]=h)}return t?n[t]:n},ot=nt,it=(e,t)=>nt(e,t,!0),qe=decodeURIComponent;var at=e=>ve(e,qe),ee,H,D,lt,ht,Be,k,ct,we=(ct=class{constructor(e,t="/",r=[[]]){p(this,D);d(this,"raw");p(this,ee);p(this,H);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});p(this,k,e=>{let{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;let n=Object.keys(t)[0];return n?t[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,f(this,H,r),f(this,ee,{})}param(e){return e?m(this,D,lt).call(this,e):m(this,D,ht).call(this)}query(e){return ot(this.url,e)}queries(e){return it(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;let t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await et(this,e))}json(){return o(this,k).call(this,"text").then(e=>JSON.parse(e))}text(){return o(this,k).call(this,"text")}arrayBuffer(){return o(this,k).call(this,"arrayBuffer")}blob(){return o(this,k).call(this,"blob")}formData(){return o(this,k).call(this,"formData")}addValidatedData(e,t){o(this,ee)[e]=t}valid(e){return o(this,ee)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[Ze](){return o(this,H)}get matchedRoutes(){return o(this,H)[0].map(([[,e]])=>e)}get routePath(){return o(this,H)[0].map(([[,e]])=>e)[this.routeIndex].path}},ee=new WeakMap,H=new WeakMap,D=new WeakSet,lt=function(e){let t=o(this,H)[0][this.routeIndex][1][e],r=m(this,D,Be).call(this,t);return r?/\%/.test(r)?at(r):r:void 0},ht=function(){let e={},t=Object.keys(o(this,H)[0][this.routeIndex][1]);for(let r of t){let s=m(this,D,Be).call(this,o(this,H)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?at(s):s)}return e},Be=function(e){return o(this,H)[1]?o(this,H)[1][e]:e},k=new WeakMap,ct);var ut={Stringify:1,BeforeStream:2,Stream:3},Ut=(e,t)=>{let r=new String(e);return r.isEscaped=!0,r.callbacks=t,r};var Ue=async(e,t,r,s,n)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));let i=e.callbacks;if(!i?.length)return Promise.resolve(e);n?n[0]+=e:n=[e];let a=Promise.all(i.map(l=>l({phase:t,buffer:n,context:s}))).then(l=>Promise.all(l.filter(Boolean).map(c=>Ue(c,t,!1,s,n))).then(()=>n[0]));return r?Ut(await a,i):a};var Ft="text/plain; charset=UTF-8",Fe=(e,t)=>({"Content-Type":e,...t}),he,ue,L,re,M,b,fe,se,ne,G,de,pe,q,te,ft,dt=(ft=class{constructor(e,t){p(this,q);p(this,he);p(this,ue);d(this,"env",{});p(this,L);d(this,"finalized",!1);d(this,"error");p(this,re);p(this,M);p(this,b);p(this,fe);p(this,se);p(this,ne);p(this,G);p(this,de);p(this,pe);d(this,"render",(...e)=>(o(this,se)??f(this,se,t=>this.html(t)),o(this,se).call(this,...e)));d(this,"setLayout",e=>f(this,fe,e));d(this,"getLayout",()=>o(this,fe));d(this,"setRenderer",e=>{f(this,se,e)});d(this,"header",(e,t,r)=>{this.finalized&&f(this,b,new Response(o(this,b).body,o(this,b)));let s=o(this,b)?o(this,b).headers:o(this,G)??f(this,G,new Headers);t===void 0?s.delete(e):r?.append?s.append(e,t):s.set(e,t)});d(this,"status",e=>{f(this,re,e)});d(this,"set",(e,t)=>{o(this,L)??f(this,L,new Map),o(this,L).set(e,t)});d(this,"get",e=>o(this,L)?o(this,L).get(e):void 0);d(this,"newResponse",(...e)=>m(this,q,te).call(this,...e));d(this,"body",(e,t,r)=>m(this,q,te).call(this,e,t,r));d(this,"text",(e,t,r)=>!o(this,G)&&!o(this,re)&&!t&&!r&&!this.finalized?new Response(e):m(this,q,te).call(this,e,t,Fe(Ft,r)));d(this,"json",(e,t,r)=>m(this,q,te).call(this,JSON.stringify(e),t,Fe("application/json",r)));d(this,"html",(e,t,r)=>{let s=n=>m(this,q,te).call(this,n,t,Fe("text/html; charset=UTF-8",r));return typeof e=="object"?Ue(e,ut.Stringify,!1,{}).then(s):s(e)});d(this,"redirect",(e,t)=>(this.header("Location",String(e)),this.newResponse(null,t??302)));d(this,"notFound",()=>(o(this,ne)??f(this,ne,()=>new Response),o(this,ne).call(this,this)));f(this,he,e),t&&(f(this,M,t.executionCtx),this.env=t.env,f(this,ne,t.notFoundHandler),f(this,pe,t.path),f(this,de,t.matchResult))}get req(){return o(this,ue)??f(this,ue,new we(o(this,he),o(this,pe),o(this,de))),o(this,ue)}get event(){if(o(this,M)&&"respondWith"in o(this,M))return o(this,M);throw Error("This context has no FetchEvent")}get executionCtx(){if(o(this,M))return o(this,M);throw Error("This context has no ExecutionContext")}get res(){return o(this,b)||f(this,b,new Response(null,{headers:o(this,G)??f(this,G,new Headers)}))}set res(e){if(o(this,b)&&e){e=new Response(e.body,e);for(let[t,r]of o(this,b).headers.entries())if(t!=="content-type")if(t==="set-cookie"){let s=o(this,b).headers.getSetCookie();e.headers.delete("set-cookie");for(let n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}f(this,b,e),this.finalized=!0}get var(){return o(this,L)?Object.fromEntries(o(this,L)):{}}},he=new WeakMap,ue=new WeakMap,L=new WeakMap,re=new WeakMap,M=new WeakMap,b=new WeakMap,fe=new WeakMap,se=new WeakMap,ne=new WeakMap,G=new WeakMap,de=new WeakMap,pe=new WeakMap,q=new WeakSet,te=function(e,t,r){let s=o(this,b)?new Headers(o(this,b).headers):o(this,G)??new Headers;if(typeof t=="object"&&"headers"in t){let i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(let[a,l]of i)a.toLowerCase()==="set-cookie"?s.append(a,l):s.set(a,l)}if(r)for(let[i,a]of Object.entries(r))if(typeof a=="string")s.set(i,a);else{s.delete(i);for(let l of a)s.append(i,l)}let n=typeof t=="number"?t:t?.status??o(this,re);return new Response(e,{status:n,headers:s})},ft);var E="ALL",pt="all",gt=["get","post","put","delete","options","patch"],Ae="Can not add a route since the matcher is already built.",Oe=class extends Error{};var mt="__COMPOSED_HANDLER";var Vt=e=>e.text("404 Not Found",404),yt=(e,t)=>{if("getResponse"in e){let r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},S,w,Rt,j,K,Pe,He,Et,Ve=(Et=class{constructor(e={}){p(this,w);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");p(this,S,"/");d(this,"routes",[]);p(this,j,Vt);d(this,"errorHandler",yt);d(this,"onError",e=>(this.errorHandler=e,this));d(this,"notFound",e=>(f(this,j,e),this));d(this,"fetch",(e,...t)=>m(this,w,He).call(this,e,t[1],t[0],e.method));d(this,"request",(e,t,r,s)=>e instanceof Request?this.fetch(t?new Request(e,t):e,r,s):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${W("/",e)}`,t),r,s)));d(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(m(this,w,He).call(this,e.request,e,void 0,e.request.method))})});[...gt,pt].forEach(n=>{this[n]=(i,...a)=>(typeof i=="string"?f(this,S,i):m(this,w,K).call(this,n,o(this,S),i),a.forEach(l=>{m(this,w,K).call(this,n,o(this,S),l)}),this)}),this.on=(n,i,...a)=>{for(let l of[i].flat()){f(this,S,l);for(let c of[n].flat())a.map(h=>{m(this,w,K).call(this,c.toUpperCase(),o(this,S),h)})}return this},this.use=(n,...i)=>(typeof n=="string"?f(this,S,n):(f(this,S,"*"),i.unshift(n)),i.forEach(a=>{m(this,w,K).call(this,E,o(this,S),a)}),this);let{strict:r,...s}=e;Object.assign(this,s),this.getPath=r??!0?e.getPath??ke:st}route(e,t){let r=this.basePath(e);return t.routes.map(s=>{var i;let n;t.errorHandler===yt?n=s.handler:(n=async(a,l)=>(await $e([],t.errorHandler)(a,()=>s.handler(a,l))).res,n[mt]=s.handler),m(i=r,w,K).call(i,s.method,s.path,n)}),this}basePath(e){let t=m(this,w,Rt).call(this);return t._basePath=W(this._basePath,e),t}mount(e,t,r){let s,n;r&&(typeof r=="function"?n=r:(n=r.optionHandler,r.replaceRequest===!1?s=l=>l:s=r.replaceRequest));let i=n?l=>{let c=n(l);return Array.isArray(c)?c:[c]}:l=>{let c;try{c=l.executionCtx}catch{}return[l.env,c]};s||(s=(()=>{let l=W(this._basePath,e),c=l==="/"?0:l.length;return h=>{let u=new URL(h.url);return u.pathname=u.pathname.slice(c)||"/",new Request(u,h)}})());let a=async(l,c)=>{let h=await t(s(l.req.raw),...i(l));if(h)return h;await c()};return m(this,w,K).call(this,E,W(e,"*"),a),this}},S=new WeakMap,w=new WeakSet,Rt=function(){let e=new Ve({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,f(e,j,o(this,j)),e.routes=this.routes,e},j=new WeakMap,K=function(e,t,r){e=e.toUpperCase(),t=W(this._basePath,t);let s={basePath:this._basePath,path:t,method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)},Pe=function(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e},He=function(e,t,r,s){if(s==="HEAD")return(async()=>new Response(null,await m(this,w,He).call(this,e,t,r,"GET")))();let n=this.getPath(e,{env:r}),i=this.router.match(s,n),a=new dt(e,{path:n,matchResult:i,env:r,executionCtx:t,notFoundHandler:o(this,j)});if(i[0].length===1){let c;try{c=i[0][0][0][0](a,async()=>{a.res=await o(this,j).call(this,a)})}catch(h){return m(this,w,Pe).call(this,h,a)}return c instanceof Promise?c.then(h=>h||(a.finalized?a.res:o(this,j).call(this,a))).catch(h=>m(this,w,Pe).call(this,h,a)):c??o(this,j).call(this,a)}let l=$e(i[0],this.errorHandler,o(this,j));return(async()=>{try{let c=await l(a);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return m(this,w,Pe).call(this,c,a)}})()},Et);var Se="[^/]+",ge=".*",me="(?:|/.*)",oe=Symbol(),Wt=new Set(".\\+*[^]$()");function Gt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===ge||e===me?1:t===ge||t===me?-1:e===Se?1:t===Se?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var z,Q,C,wt,je=(wt=class{constructor(){p(this,z);p(this,Q);p(this,C,Object.create(null))}insert(e,t,r,s,n){if(e.length===0){if(o(this,z)!==void 0)throw oe;if(n)return;f(this,z,t);return}let[i,...a]=e,l=i==="*"?a.length===0?["","",ge]:["","",Se]:i==="/*"?["","",me]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),c;if(l){let h=l[1],u=l[2]||Se;if(h&&l[2]&&(u=u.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(u)))throw oe;if(c=o(this,C)[u],!c){if(Object.keys(o(this,C)).some(g=>g!==ge&&g!==me))throw oe;if(n)return;c=o(this,C)[u]=new je,h!==""&&f(c,Q,s.varIndex++)}!n&&h!==""&&r.push([h,o(c,Q)])}else if(c=o(this,C)[i],!c){if(Object.keys(o(this,C)).some(h=>h.length>1&&h!==ge&&h!==me))throw oe;if(n)return;c=o(this,C)[i]=new je}c.insert(a,t,r,s,n)}buildRegExpStr(){let t=Object.keys(o(this,C)).sort(Gt).map(r=>{let s=o(this,C)[r];return(typeof o(s,Q)=="number"?`(${r})@${o(s,Q)}`:Wt.has(r)?`\\${r}`:r)+s.buildRegExpStr()});return typeof o(this,z)=="number"&&t.unshift(`#${o(this,z)}`),t.length===0?"":t.length===1?t[0]:"(?:"+t.join("|")+")"}},z=new WeakMap,Q=new WeakMap,C=new WeakMap,wt);var Ce,ye,xt,vt=(xt=class{constructor(){p(this,Ce,{varIndex:0});p(this,ye,new je)}insert(e,t,r){let s=[],n=[];for(let a=0;;){let l=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{let h=`@\\${a}`;return n[a]=[h,c],a++,l=!0,h}),!l)break}let i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){let[l]=n[a];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(l)!==-1){i[c]=i[c].replace(l,n[a][1]);break}}return o(this,ye).insert(i,t,s,o(this,Ce),r),s}buildRegExp(){let e=o(this,ye).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0,r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>i!==void 0?(r[++t]=Number(i),"$()"):(a!==void 0&&(s[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,s]}},Ce=new WeakMap,ye=new WeakMap,xt);var At=[],Kt=[/^$/,[],Object.create(null)],Te=Object.create(null);function Ot(e){return Te[e]??(Te[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function zt(){Te=Object.create(null)}function Qt(e){let t=new vt,r=[];if(e.length===0)return Kt;let s=e.map(h=>[!/\*|\/:/.test(h[0]),...h]).sort(([h,u],[g,y])=>h?1:g?-1:u.length-y.length),n=Object.create(null);for(let h=0,u=-1,g=s.length;h<g;h++){let[y,O,R]=s[h];y?n[O]=[R.map(([P])=>[P,Object.create(null)]),At]:u++;let A;try{A=t.insert(O,u,y)}catch(P){throw P===oe?new Oe(O):P}y||(r[u]=R.map(([P,Z])=>{let le=Object.create(null);for(Z-=1;Z>=0;Z--){let[T,De]=A[Z];le[T]=De}return[P,le]}))}let[i,a,l]=t.buildRegExp();for(let h=0,u=r.length;h<u;h++)for(let g=0,y=r[h].length;g<y;g++){let O=r[h][g]?.[1];if(!O)continue;let R=Object.keys(O);for(let A=0,P=R.length;A<P;A++)O[R[A]]=l[O[R[A]]]}let c=[];for(let h in a)c[h]=r[a[h]];return[i,c,n]}function ie(e,t){if(e){for(let r of Object.keys(e).sort((s,n)=>n.length-s.length))if(Ot(r).test(t))return[...e[r]]}}var B,U,ae,Pt,Ht,bt,We=(bt=class{constructor(){p(this,ae);d(this,"name","RegExpRouter");p(this,B);p(this,U);f(this,B,{[E]:Object.create(null)}),f(this,U,{[E]:Object.create(null)})}add(e,t,r){var l;let s=o(this,B),n=o(this,U);if(!s||!n)throw new Error(Ae);s[e]||[s,n].forEach(c=>{c[e]=Object.create(null),Object.keys(c[E]).forEach(h=>{c[e][h]=[...c[E][h]]})}),t==="/*"&&(t="*");let i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){let c=Ot(t);e===E?Object.keys(s).forEach(h=>{var u;(u=s[h])[t]||(u[t]=ie(s[h],t)||ie(s[E],t)||[])}):(l=s[e])[t]||(l[t]=ie(s[e],t)||ie(s[E],t)||[]),Object.keys(s).forEach(h=>{(e===E||e===h)&&Object.keys(s[h]).forEach(u=>{c.test(u)&&s[h][u].push([r,i])})}),Object.keys(n).forEach(h=>{(e===E||e===h)&&Object.keys(n[h]).forEach(u=>c.test(u)&&n[h][u].push([r,i]))});return}let a=be(t)||[t];for(let c=0,h=a.length;c<h;c++){let u=a[c];Object.keys(n).forEach(g=>{var y;(e===E||e===g)&&((y=n[g])[u]||(y[u]=[...ie(s[g],u)||ie(s[E],u)||[]]),n[g][u].push([r,i-h+c+1]))})}}match(e,t){zt();let r=m(this,ae,Pt).call(this);return this.match=(s,n)=>{let i=r[s]||r[E],a=i[2][n];if(a)return a;let l=n.match(i[0]);if(!l)return[[],At];let c=l.indexOf("",1);return[i[1][c],l]},this.match(e,t)}},B=new WeakMap,U=new WeakMap,ae=new WeakSet,Pt=function(){let e=Object.create(null);return Object.keys(o(this,U)).concat(Object.keys(o(this,B))).forEach(t=>{e[t]||(e[t]=m(this,ae,Ht).call(this,t))}),f(this,B,f(this,U,void 0)),e},Ht=function(e){let t=[],r=e===E;return[o(this,B),o(this,U)].forEach(s=>{let n=s[e]?Object.keys(s[e]).map(i=>[i,s[e][i]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==E&&t.push(...Object.keys(s[E]).map(i=>[i,s[E][i]]))}),r?Qt(t):null},bt);var F,$,St,Ge=(St=class{constructor(e){d(this,"name","SmartRouter");p(this,F,[]);p(this,$,[]);f(this,F,e.routers)}add(e,t,r){if(!o(this,$))throw new Error(Ae);o(this,$).push([e,t,r])}match(e,t){if(!o(this,$))throw new Error("Fatal error");let r=o(this,F),s=o(this,$),n=r.length,i=0,a;for(;i<n;i++){let l=r[i];try{for(let c=0,h=s.length;c<h;c++)l.add(...s[c]);a=l.match(e,t)}catch(c){if(c instanceof Oe)continue;throw c}this.match=l.match.bind(l),f(this,F,[l]),f(this,$,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(o(this,$)||o(this,F).length!==1)throw new Error("No active router has been determined yet.");return o(this,F)[0]}},F=new WeakMap,$=new WeakMap,St);var Ee=Object.create(null),V,v,Y,ce,x,N,X,jt,Ke=(jt=class{constructor(e,t,r){p(this,N);p(this,V);p(this,v);p(this,Y);p(this,ce,0);p(this,x,Ee);if(f(this,v,r||Object.create(null)),f(this,V,[]),e&&t){let s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},f(this,V,[s])}f(this,Y,[])}insert(e,t,r){f(this,ce,++Je(this,ce)._);let s=this,n=tt(t),i=[];for(let a=0,l=n.length;a<l;a++){let c=n[a],h=n[a+1],u=rt(c,h),g=Array.isArray(u)?u[0]:c;if(g in o(s,v)){s=o(s,v)[g],u&&i.push(u[1]);continue}o(s,v)[g]=new Ke,u&&(o(s,Y).push(u),i.push(u[1])),s=o(s,v)[g]}return o(s,V).push({[e]:{handler:r,possibleKeys:i.filter((a,l,c)=>c.indexOf(a)===l),score:o(this,ce)}}),s}search(e,t){let r=[];f(this,x,Ee);let n=[this],i=Ie(t),a=[];for(let l=0,c=i.length;l<c;l++){let h=i[l],u=l===c-1,g=[];for(let y=0,O=n.length;y<O;y++){let R=n[y],A=o(R,v)[h];A&&(f(A,x,o(R,x)),u?(o(A,v)["*"]&&r.push(...m(this,N,X).call(this,o(A,v)["*"],e,o(R,x))),r.push(...m(this,N,X).call(this,A,e,o(R,x)))):g.push(A));for(let P=0,Z=o(R,Y).length;P<Z;P++){let le=o(R,Y)[P],T=o(R,x)===Ee?{}:{...o(R,x)};if(le==="*"){let I=o(R,v)["*"];I&&(r.push(...m(this,N,X).call(this,I,e,o(R,x))),f(I,x,T),g.push(I));continue}if(!h)continue;let[De,Xe,Re]=le,_=o(R,v)[De],_t=i.slice(l).join("/");if(Re instanceof RegExp){let I=Re.exec(_t);if(I){if(T[Xe]=I[0],r.push(...m(this,N,X).call(this,_,e,o(R,x),T)),Object.keys(o(_,v)).length){f(_,x,T);let Le=I[0].match(/\//)?.length??0;(a[Le]||(a[Le]=[])).push(_)}continue}}(Re===!0||Re.test(h))&&(T[Xe]=h,u?(r.push(...m(this,N,X).call(this,_,e,T,o(R,x))),o(_,v)["*"]&&r.push(...m(this,N,X).call(this,o(_,v)["*"],e,T,o(R,x)))):(f(_,x,T),g.push(_)))}}n=g.concat(a.shift()??[])}return r.length>1&&r.sort((l,c)=>l.score-c.score),[r.map(({handler:l,params:c})=>[l,c])]}},V=new WeakMap,v=new WeakMap,Y=new WeakMap,ce=new WeakMap,x=new WeakMap,N=new WeakSet,X=function(e,t,r,s){let n=[];for(let i=0,a=o(e,V).length;i<a;i++){let l=o(e,V)[i],c=l[t]||l[E],h={};if(c!==void 0&&(c.params=Object.create(null),n.push(c),r!==Ee||s&&s!==Ee))for(let u=0,g=c.possibleKeys.length;u<g;u++){let y=c.possibleKeys[u],O=h[c.score];c.params[y]=s?.[y]&&!O?s[y]:r[y]??s?.[y],h[c.score]=!0}}return n},jt);var J,Ct,ze=(Ct=class{constructor(){d(this,"name","TrieRouter");p(this,J);f(this,J,new Ke)}add(e,t,r){let s=be(t);if(s){for(let n=0,i=s.length;n<i;n++)o(this,J).insert(e,s[n],r);return}o(this,J).insert(e,t,r)}match(e,t){return o(this,J).search(e,t)}},J=new WeakMap,Ct);var Qe=class extends Ve{constructor(e={}){super(e),this.router=e.router??new Ge({routers:[new We,new ze]})}};var Tt=e=>{let r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},s=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(r.origin),n=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(a,l){function c(u,g){a.res.headers.set(u,g)}let h=s(a.req.header("origin")||"",a);if(h&&c("Access-Control-Allow-Origin",h),r.origin!=="*"){let u=a.req.header("Vary");u?c("Vary",u):c("Vary","Origin")}if(r.credentials&&c("Access-Control-Allow-Credentials","true"),r.exposeHeaders?.length&&c("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.maxAge!=null&&c("Access-Control-Max-Age",r.maxAge.toString());let u=n(a.req.header("origin")||"",a);u.length&&c("Access-Control-Allow-Methods",u.join(","));let g=r.allowHeaders;if(!g?.length){let y=a.req.header("Access-Control-Request-Headers");y&&(g=y.split(/\s*,\s*/))}return g?.length&&(c("Access-Control-Allow-Headers",g.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await l()}};var _e=new Qe;_e.use(Tt());_e.get("/",e=>e.text("Hello Hono!"));_e.get("/hello",async e=>{let t={message:"Hello BHVR!",success:!0};return e.json(t,{status:200})});var ys={async fetch(e,t,r){return _e.fetch(e,t,r)}};export{ys as default};
